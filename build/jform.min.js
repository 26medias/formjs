(function(){var b=function(){this.components={};this.plugins={}};b.prototype.component=function(d,c,e){if(this.components[d]){console.info("/! Module '"+d+"' is already defined. Duplicate:",e);this.formErrors.push("/! Module '"+d+"' is already defined.");return false}else{this.components[d]=c;return true}};b.prototype.plugin=function(d,f,e,c){if(this.plugins[d]&&!c){console.info("/! Plugin '"+d+"' is already defined. Duplicate:",e);this.formErrors.push("/! Plugin '"+d+"' is already defined.");return false}else{this.plugins[d]=f;return true}};b.prototype.dom=function(c,e,d){var f=document.createElement(c);if(e!=undefined){$(e).append($(f))}return(d===true)?f:$(f)};var a=function(d,c){this.fields={};this.data={};this.errors=[];this.formErrors=[];if(c){this.use=c}else{this.use=[]}this.container=d;this.theme={line:{classname:"form-group",type:"div"},label:{classname:"control-label",type:"label"},field:{classname:false,type:"div"}};var e=this;_.each(this.use,function(f){console.log("Loading ",f);if(window.formjsFactory.plugins[f]){window.formjsFactory.plugins[f](e)}else{console.error("/! Plugin '"+f+"' is missing.");this.formErrors.push("Plugin '"+f+"' is missing.")}});this.conditionFramework=function(f){if(!e.fields[f]){console.error("/! Condition: field '"+f+"' desn't exist.");e.formErrors.push("Condition: field '"+f+"' desn't exist.");return this}this.field=e.fields[f];return this};this.conditionFramework.prototype.equal=function(f){if(!this.field){console.error("/! Condition: No field selected.");e.formErrors.push("Condition: No field selected.");return false}if(!this.field.active){return false}if(this.field.instance.validate()&&this.field.instance.val()==f){return true}return false};this.conditionFramework.prototype.contains=function(h){if(!this.field){console.error("/! Condition: No field selected.");g.formErrors.push("Condition: No field selected.");return false}if(!this.field.active){return false}var g=this;if(_.isArray(h)){if(!g.field.instance.validate()){return false}var f=true;_.each(h,function(i){f&=_.contains(g.field.instance.val(),i)});return f}else{if(this.field.instance.validate()&&_.contains(this.field.instance.val(),h)){return true}}return false}};a.prototype.build=function(c){var d=this;this.options=_.extend({form:{},submit:$(),onSubmit:function(){},onError:function(){},onInit:function(){}},c);_.each(this.options.form,function(g){if(g.condition&&typeof g.condition=="string"){(function(h){h.condition=new Function("scope","with(scope){return "+h.condition+";}")(this)})(g)}if(d.fields[g.name]){console.info("/! field '"+g.name+"' is already defined. Duplicate:",d.fields[g.name]);d.formErrors.push("field '"+g.name+"' is already defined.");return this}else{if(!window.formjsFactory.components[g.type]){console.info("/! factory '"+g.type+"' doesn't exist on ",g);d.formErrors.push("factory '"+g.type+"' doesn't exist.");return this}else{var e=new window.formjsFactory.components[g.type](d,g);var f=d.createLine(g);e.build(f);e.onUpdate(function(){d.executeConditions()});d.fields[g.name]={factory:window.formjsFactory.components[g.type],instance:e,data:g,line:f,active:true};f.line.hide()}return this}});this.options.submit.unbind("click").bind("click",function(){if(d.validate()){d.options.onSubmit(d.data,d)}else{d.options.onError(d.errors,d)}});this.executeConditions();d.options.onInit(this);return this};a.prototype.validate=function(e){var d;this.data={};this.errors=[];var c=false;for(d in this.fields){if(this.fields[d].active){if(this.fields[d].instance.isFilled()){if(this.fields[d].instance.validate()){this.data[d]=this.fields[d].instance.val()}else{c|=true;this.errors.push({field:this.fields[d],name:d})}}else{if(this.fields[d].data.required){c|=true;this.errors.push({field:this.fields[d],name:d})}else{}}}}if(c){return false}else{return true}};a.prototype.executeConditions=function(){var c;var d=0;for(c in this.fields){if(this.fields[c].data.condition){if(this.fields[c].data.condition(this.conditionFramework)){if(this.fields[c].active!=true){d++;this.fields[c].active=true;this.fields[c].line.line.slideDown()}}else{if(this.fields[c].active!=false){d++;this.fields[c].active=false;this.fields[c].line.line.slideUp()}}}else{this.fields[c].line.line.slideDown()}}if(d>0){this.executeConditions()}};a.prototype.createLine=function(e){var c=window.formjsFactory.dom(this.theme.line.type,this.container);if(this.theme.line.classname){c.addClass(this.theme.line.classname)}var d=window.formjsFactory.dom(this.theme.label.type,c);d.html(e.label);if(this.theme.label.classname){d.addClass(this.theme.label.classname)}var f=window.formjsFactory.dom(this.theme.field.type,c);if(this.theme.field.classname){f.addClass(this.theme.field.classname)}return{line:c,label:d,field:f}};a.prototype.stringify=function(d){var c=[];_.each(this.options.form,function(e){var f=_.extend({},e);if(f.condition&&typeof f.condition!="string"){f.condition=f.condition.toString().replace(/\/\*[.\r\n\t\w\W\s]*\*\//,"").replace(/\/\/(.*)[\r\n]/gm,"").replace(/[\t\r\n]/gm,"")}c.push(f)});if(d){return JSON.stringify(c,null,4)}else{return JSON.stringify(c)}};window.formjsFactory=new b();window.formjs=a})();(function(){window.formjsFactory.plugin("accordion",function(a){console.log("formjs",a);a.createLine=function(e){if(!a.container.attr("id")){a.container.attr("id",_.uniqueId("form"))}var i=_.uniqueId("accordion");var c=window.formjsFactory.dom("div",a.container);c.addClass("panel").addClass("panel-default");var f=window.formjsFactory.dom("div",c);f.addClass("panel-heading");var h=window.formjsFactory.dom("div",f);h.addClass("panel-title");var d=window.formjsFactory.dom("a",h);d.html(e.label);d.attr("data-toggle","collapse").attr("data-parent","#"+a.container.attr("id")).attr("href","#"+i);var g=window.formjsFactory.dom("div",c);g.addClass("panel-collapse").addClass("collapse");g.attr("id",i);var b=window.formjsFactory.dom("div",g);b.addClass("panel-body");return{line:c,label:d,field:b}}},{description:"Accordion: Display the survey as an accordion",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){window.formjsFactory.plugin("bootstrap",function(a){a.bootstrap={showErrors:function(){a.container.find(".has-error").removeClass("has-error");if(a.errors.length>0){_.each(a.errors,function(b){b.field.line.line.addClass("has-error")})}},resetErrors:function(){a.container.find(".has-error").removeClass("has-error")}}},{description:"Bootstrap: Utilities to manage bootstrap forms, showing errors for example.",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c;this.value=[];this.onUpdateCallback=function(){}};a.prototype.build=function(b){var c=this;this.line=b;_.each(this.data.list,function(f){var h=_.uniqueId(c.data.name);var d=window.formjsFactory.dom("div",b.field);d.addClass("checkbox");var g=window.formjsFactory.dom("input",d,true);g.type="checkbox";g=$(g);g.attr("id",h);g.click(function(){if(g.is(":checked")){c.value.push(f.value);c.value=_.uniq(c.value)}else{c.value=_.without(c.value,f.value)}c.onUpdateCallback()});var e=window.formjsFactory.dom("label",d);e.html(f.label);e.attr("for",h)})};a.prototype.validate=function(b){if(this.value.length>0){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.value=b()}else{return this.value}};a.prototype.isFilled=function(){return this.value.length>0};a.prototype.onUpdate=function(b){this.onUpdateCallback=b};window.formjsFactory.component("checkbox",a,{description:"A simple checkbox list",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c;this.value="";this.onUpdateCallback=function(){}};a.prototype.build=function(b){var d=this;this.line=b;var c=_.uniqueId(d.data.name);_.each(this.data.list,function(g){var i=_.uniqueId(d.data.name);var e=window.formjsFactory.dom("div",b.field);e.addClass("radio");var h=window.formjsFactory.dom("input",e,true);h.type="radio";h=$(h);h.attr("id",i);h.attr("name",c);h.attr("value",g.value);h.click(function(){d.onUpdateCallback()});var f=window.formjsFactory.dom("label",e);f.html(g.label);f.attr("for",i)})};a.prototype.validate=function(b){if(this.val()&&this.val()!=""){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.value=b()}else{return this.line.field.find("input[type=radio]:checked").val()}};a.prototype.isFilled=function(){return this.val()&&this.val()!=""};a.prototype.onUpdate=function(b){this.onUpdateCallback=b};window.formjsFactory.component("radio",a,{description:"Radio, simple radio list",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c};a.prototype.build=function(b){this.line=b;this.field=window.formjsFactory.dom("input",b.field,true);this.field.type="varchar";this.field=$(this.field);if(this.data.placeholder){this.field.attr("placeholder",this.data.placeholder)}this.field.addClass("form-control")};a.prototype.validate=function(b){if(this.val().trim()!=""){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.field.val(b)}else{return this.field.val()}};a.prototype.isFilled=function(){return this.val().trim()!=""};a.prototype.onUpdate=function(b){this.field.bind("change",b)};window.formjsFactory.component("varchar",a,{description:"Varchar, simple input text, single line.",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();